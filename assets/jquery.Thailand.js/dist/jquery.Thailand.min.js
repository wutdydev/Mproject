/**
 * @name jquery.Thailand.js
 * @version 1.5.1
 * @update Jul 14, 2017
 * @website https://github.com/earthchie/jquery.Thailand.js
 * @license WTFPL v.2 - http://www.wtfpl.net/
 *
 * @dependencies: jQuery <https://jquery.com/>
 *              zip.js <https://github.com/gildas-lormeau/zip.js> (optional: for zip database_type only)
 *              typeahead.js <https://twitter.github.io/typeahead.js/>
 *              JQL.js <https://github.com/earthchie/JQL.js>
 **/
$.Thailand=function(c){'use strict';c=$.extend({database:'../database/db.json',database_type:'auto',zip_worker_path:!1,autocomplete_size:20,onLoad:function(){},onDataFill:function(){},$district:!1,$district_code:!1,$amphoe:!1,$amphoe_code:!1,$province:!1,$province_code:!1,$zipcode:!1,$search:!1},c);var d=function(h){var s,j=[],k=[],n=[],o=!1;return(h.lookup&&h.words&&(o=!0,j=h.lookup.split('|'),k=h.words.split('|'),h=h.data),s=function(u){return o?('number'==typeof u&&(u=j[u]),u.replace(/[A-Z]/ig,function(x){var y=x.charCodeAt(0);return k[97>y?y-65:26+y-97]})):u},!h[0].length)?h:(h.map(function(u){var w=1;3===u.length&&(w=2),u[w].map(function(x){x[w].map(function(y){y[w]=y[w]instanceof Array?y[w]:[y[w]],y[w].map(function(z){var A={district:s(y[0]),amphoe:s(x[0]),province:s(u[0]),zipcode:z};2==w&&(A.district_code=y[1]||!1,A.amphoe_code=x[1]||!1,A.province_code=u[1]||!1),n.push(A)})})})}),n)},f=function(h,j,k){h+='',j+='';var x,y,z,A,n=0,o=0,s=0,u=h.length,w=j.length;for(x=0;x<u;++x)for(y=0;y<w;++y){for(z=0;x+z<u&&y+z<w&&h.charAt(x+z)===j.charAt(y+z);)++z;z>s&&(s=z,n=x,o=y)}return A=s,A&&(n&&o&&(A+=f(h.substr(0,o),j.substr(0,o),!1)),n+s<u&&o+s<w&&(A+=f(h.substr(n+s,u-n-s),j.substr(o+s,w-o-s),!1))),!1===k?A:h===j?100:u>w?Math.floor(100*(A/u)):Math.floor(100*(A/w))};(function(h){var k,j=c.database_type.toLowerCase();switch('json'!==j&&'zip'!==j&&(j=c.database.split('.').pop()),j){case'json':$.getJSON(c.database,function(n){h(new JQL(d(n)))}).fail(function(){throw new Error('File "'+c.database+'" is not exists.')});break;case'zip':c.zip_worker_path||$('script').each(function(){var n=this.src.split('/'),o=n.pop();'zip.js'===o&&(zip.workerScriptsPath=n.join('/')+'/')}),k=new XMLHttpRequest,k.responseType='blob',k.onreadystatechange=function(){if(4===k.readyState)if(200===k.status)zip.createReader(new zip.BlobReader(k.response),function(n){n.getEntries(function(o){o[0].getData(new zip.BlobWriter,function(s){var u=new FileReader;u.onload=function(){h(new JQL(d(JSON.parse(u.result))))},u.readAsText(s)})})});else throw new Error('File "'+c.database+'" is not exists.')},k.open('GET',c.database),k.send();break;default:throw new Error('Unknown database type: "'+c.database_type+'". Please define database_type explicitly (json or zip)');}})(function(h){var j,k,n={empty:' ',suggestion:function(s){return s.zipcode&&(s.zipcode=' \xBB '+s.zipcode),'<div>'+s.district+' \xBB '+s.amphoe+' \xBB '+s.province+s.zipcode+'</div>'}},o=function(s,u){for(j in c)k=j.replace('$',''),-1<j.indexOf('$')&&c.hasOwnProperty(j)&&c[j]&&u[k]&&c[j].typeahead('val',u[k]).trigger('change');'function'==typeof c.onDataFill&&(delete u.likely,c.onDataFill(u))};for(j in c)-1<j.indexOf('$')&&'$search'!==j&&c.hasOwnProperty(j)&&c[j]&&c[j].typeahead({hint:!0,highlight:!0,minLength:1},{limit:c.autocomplete_size,templates:n,source:function(s,u){var w=[],x=this.$el.data('field');try{w=h.select('*').where(x).match('^'+s).orderBy(x).fetch()}catch(y){}u(w)},display:function(s){return s[this.$el.data('field')]}}).parent().find('.tt-dataset').data('field',j.replace('$',''));for(j in c.$search&&c.$search.typeahead({hint:!0,highlight:!0,minLength:2},{limit:c.autocomplete_size,templates:n,source:function(s,u){var w=[];try{w=new JQL(w.concat(h.select('*').where('zipcode').match(s).fetch()).concat(h.select('*').where('province').match(s).fetch()).concat(h.select('*').where('amphoe').match(s).fetch()).concat(h.select('*').where('district').match(s).fetch()).map(function(y){return JSON.stringify(y)}).filter(function(y,z,A){return A.indexOf(y)==z}).map(function(y){return y=JSON.parse(y),y.likely=[5*f(s,y.district),3*f(s,y.amphoe.replace(/^เมือง/,'')),f(s,y.province),f(s,y.zipcode)].reduce(function(z,A){return Math.max(z,A)}),y})).select('*').orderBy('likely desc').fetch()}catch(y){}u(w)},display:function(){return''}}),c)-1<j.indexOf('$')&&c.hasOwnProperty(j)&&c[j]&&c[j].bind('typeahead:select typeahead:autocomplete',o).blur(function(){this.value||$(this).parent().find('.tt-dataset').html('')});'function'==typeof c.onLoad&&c.onLoad(),'function'==typeof c.onComplete&&c.onComplete()})};